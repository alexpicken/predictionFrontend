<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>CanWeBeatTheDragon</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="img/callum-the-dragon-image.webp" type="image/x-icon">
</head>

<body onload="loadFunction()">
  <main>

    <section>
      <h2 class="headin">Ranking Table</h2>
      <div class="table-container">
        <table id="rankingTable">
          <thead>
            <tr class="col">
              <th>Name</th>
              <th>Total Score</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be added here -->
          </tbody>
        </table>
      </div>
    </section>
    
    <section>
      <h2 class="headin">Real Table</h2>
      <div class="table-container">
        <table id="realTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be added here -->
          </tbody>
        </table>
      </div>
      <h2 class="hidden"></h2>
    </section>

    <section>
      <h2 class="headin">Alex's Table</h2>
      <div class="table-container">
        <table id="alexTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="alexSum"></h2>
    </section>

    <section>
      <h2 class="headin">Hugo's Table</h2>
      <div class="table-container">
        <table id="hugoTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="hugoSum"></h2>
    </section>

    <section>
      <h2 class="headin">Dragon's Table</h2>
      <div class="table-container">
        <table id="dragonTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="dragonSum"></h2>
    </section>

    <section>
      <h2 class="headin">JLA's Table</h2>
      <div class="table-container">
        <table id="jlaTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="jlaSum"></h2>
    </section>

    <section>
      <h2 class="headin">Rory's Table</h2>
      <div class="table-container">
        <table id="roryTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="rorySum"></h2>
    </section>

    <section>
      <h2 class="headin">Spencer's Table</h2>
      <div class="table-container">
        <table id="spencerTable">
          <thead>
            <tr class="col">
              <th>Position</th>
              <th>Team</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <h2 class="headin" id="spencerSum"></h2>
    </section>

  </main>

  <script>

    const alexData = [
      "Liverpool",
      "Manchester City",
      "Arsenal",
      "Manchester United",
      "Chelsea",
      "Aston Villa",
      "Newcastle United",
      "Brighton & Hove Albion",
      "Tottenham Hotspur",
      "Brentford",
      "Crystal Palace",
      "West Ham United",
      "Bournemouth",
      "Burnley",
      "Fulham",
      "Everton",
      "Wolverhampton Wanderers",
      "Nottingham Forest",
      "Luton Town",
      "Sheffield United"
    ];

    const hugoData = [
      "Arsenal",
      "Manchester City",
      "Liverpool",
      "Chelsea",
      "Manchester United",
      "Newcastle United",
      "Brighton & Hove Albion",
      "Tottenham Hotspur",
      "Aston Villa",
      "Brentford",
      "Burnley",
      "Fulham",
      "West Ham United",
      "Crystal Palace",
      "Nottingham Forest",
      "Everton",
      "Bournemouth",
      "Wolverhampton Wanderers",
      "Luton Town",
      "Sheffield United"
    ];

    const dragonData = [
      "Manchester City",
      "Manchester United",
      "Liverpool",
      "Newcastle United",
      "Arsenal",
      "Chelsea",
      "Brentford",
      "Tottenham Hotspur",
      "Aston Villa",
      "Burnley",
      "Crystal Palace",
      "Brighton & Hove Albion",
      "Nottingham Forest",
      "Fulham",
      "West Ham United",
      "Wolverhampton Wanderers",
      "Everton",
      "Bournemouth",
      "Luton Town",
      "Sheffield United"
    ];

    const jlaData = [
      "Manchester City",
      "Liverpool",
      "Arsenal",
      "Manchester United",
      "Chelsea",
      "Aston Villa",
      "Tottenham Hotspur",
      "Newcastle United",
      "Brighton & Hove Albion",
      "West Ham United",
      "Bournemouth",
      "Burnley",
      "Brentford",
      "Crystal Palace",
      "Fulham",
      "Nottingham Forest",
      "Everton",
      "Wolverhampton Wanderers",
      "Luton Town",
      "Sheffield United"
    ];

    const roryData = [
      "Arsenal",
      "Manchester City",
      "Liverpool",
      "Manchester United",
      "Chelsea",
      "Aston Villa",
      "Newcastle United",
      "Tottenham Hotspur",
      "Brighton & Hove Albion",
      "Crystal Palace",
      "Fulham",
      "Brentford",
      "Burnley",
      "West Ham United",
      "Wolverhampton Wanderers",
      "Bournemouth",
      "Nottingham Forest",
      "Everton",
      "Luton Town",
      "Sheffield United"
    ];

    const spencerData = [
      "Manchester City",
      "Arsenal",
      "Manchester United",
      "Chelsea",
      "Liverpool",
      "Tottenham Hotspur",
      "Newcastle United",
      "Aston Villa",
      "Brighton & Hove Albion",
      "West Ham United",
      "Brentford",
      "Burnley",
      "Crystal Palace",
      "Everton",
      "Bournemouth",
      "Nottingham Forest",
      "Fulham",
      "Wolverhampton Wanderers",
      "Sheffield United",
      "Luton Town",
    ];

    const createRealTable = async () => {
      let requestOptions = {
        'content-type': 'application/json',
        mode: 'cors',
        method: 'GET'
      };
      const response = await fetch('https://beatthedragon.onrender.com/', requestOptions);
      var data = await response.json();
      return Array.from(data);
    }

    function createTable(data, selector) {

      const tableBody = document.querySelector(selector);
      tableBody.replaceChildren();

      data.forEach((string, index) => {
        const newRow = document.createElement("tr");
        if (index + 1 <= 4) {
          newRow.classList.add("wpos");
        } else if (index + 1 >= 18) {
          newRow.classList.add("lpos");
        } else {
          newRow.classList.add("pos");
        }

        const newDataCell = document.createElement("td");
        newDataCell.textContent = index + 1;

        const newDataCell2 = document.createElement("td");
        newDataCell2.textContent = string;

        newRow.appendChild(newDataCell);
        newRow.appendChild(newDataCell2);

        tableBody.appendChild(newRow);
      });
    }

    function evaluateDifference(positionsMap, testSelector) {
      const testRows = document.querySelectorAll(testSelector);

      testRows.forEach(row => {
        const name = row.cells[1].textContent;
        const position = parseInt(row.cells[0].textContent);

        const positionFromRealTable = positionsMap.get(name);

        let difference = 0;
        if (positionFromRealTable >= position) {
          difference = positionFromRealTable - position;
        } else {
          difference = position - positionFromRealTable;
        }

        const newCell = document.createElement('td');
        newCell.textContent = difference;
        row.appendChild(newCell);

      });
    }

    function generateRealMap(realSelector) {
      const positionsMap = new Map();
      const realRows = document.querySelectorAll(realSelector);

      realRows.forEach(row => {
        const name = row.cells[1].textContent;
        const position = parseInt(row.cells[0].textContent);
        positionsMap.set(name, position);
      })

      return (positionsMap);
    }

    function sumColumn(tableSelector, documentSelector) {
      const rows = document.querySelectorAll(tableSelector);
      let sum = 0;

      rows.forEach(row => {
        const cellValue = parseInt(row.cells[2].textContent);
        sum += cellValue;
      });

      document.getElementById(documentSelector).innerHTML = "Score: " + sum;
    }

    function updateRankingTable() {
      const rankingTableBody = document.querySelector("#rankingTable tbody");
      rankingTableBody.replaceChildren();

      const participants = [
        { name: "Alex", sumSelector: "#alexSum" },
        { name: "Hugo", sumSelector: "#hugoSum" },
        { name: "Dragon", sumSelector: "#dragonSum" },
        { name: "JLA", sumSelector: "#jlaSum" },
        { name: "Rory", sumSelector: "#rorySum" },
        { name: "Spencer", sumSelector: "#spencerSum" },
      ];

      participants.sort((a, b) => {
        const sumA = parseInt(document.querySelector(a.sumSelector).textContent.split(":")[1].trim());
        const sumB = parseInt(document.querySelector(b.sumSelector).textContent.split(":")[1].trim());
        return sumA - sumB;
      });

      participants.forEach(participant => {
        const newRow = document.createElement("tr");
        const nameCell = document.createElement("td");
        const sumCell = document.createElement("td");

        nameCell.textContent = participant.name;
        sumCell.textContent = document.querySelector(participant.sumSelector).textContent;

        newRow.appendChild(nameCell);
        newRow.appendChild(sumCell);

        rankingTableBody.appendChild(newRow);
      });
    }

    async function loadFunction() {

      realData = await createRealTable();

      createTable(realData, "#realTable tbody");
      createTable(alexData, "#alexTable tbody");
      createTable(hugoData, "#hugoTable tbody");
      createTable(dragonData, "#dragonTable tbody");
      createTable(jlaData, "#jlaTable tbody");
      createTable(roryData, "#roryTable tbody");
      createTable(spencerData, "#spencerTable tbody");

      positionsMap = generateRealMap("#realTable tbody tr");

      evaluateDifference(positionsMap, "#alexTable tbody tr");
      evaluateDifference(positionsMap, "#hugoTable tbody tr");
      evaluateDifference(positionsMap, "#dragonTable tbody tr");
      evaluateDifference(positionsMap, "#jlaTable tbody tr");
      evaluateDifference(positionsMap, "#roryTable tbody tr");
      evaluateDifference(positionsMap, "#spencerTable tbody tr");

      sumColumn("#alexTable tbody tr", "alexSum");
      sumColumn("#hugoTable tbody tr", "hugoSum");
      sumColumn("#dragonTable tbody tr", "dragonSum");
      sumColumn("#jlaTable tbody tr", "jlaSum");
      sumColumn("#roryTable tbody tr", "rorySum");
      sumColumn("#spencerTable tbody tr", "spencerSum");

      updateRankingTable();
    }


  </script>
</body>

</html>